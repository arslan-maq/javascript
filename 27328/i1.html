<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Historical Document Explorer</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      h1 {
        text-align: center;
        margin-bottom: 20px;
      }
      .filter-container {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
      }
      .filter-container label {
        margin-right: 10px;
        font-weight: bold;
      }
      .filter-container select {
        margin-right: 20px;
        padding: 5px;
        font-size: 16px;
      }
      #timeline,
      #networkGraph,
      #themesAnalysis {
        width: 100%;
        height: 300px;
        margin: 20px 0;
      }
      #networkGraph {
        height: 400px;
      }
      .document-info {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Historical Document Explorer</h1>

    <!-- Filters -->
    <div class="filter-container">
      <label for="themeFilter">Filter by Theme:</label>
      <select id="themeFilter">
        <option value="">All Themes</option>
      </select>

      <label for="authorFilter">Filter by Author:</label>
      <select id="authorFilter">
        <option value="">All Authors</option>
      </select>
    </div>

    <h2>Documents Published Over Time</h2>
    <canvas id="timeline"></canvas>

    <h2>Distribution of Themes in Documents</h2>
    <canvas id="themesAnalysis"></canvas>

    <h2>Document Relationships Network</h2>
    <div id="networkGraph"></div>
    <div id="documentInfo" class="document-info"></div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Include date adapter (e.g., date-fns) -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

    <script>
      const documents = [
        {
          id: 1,
          title: "The Treaty of Versailles",
          author: "Unknown",
          date: "1919-06-28",
          themes: ["World War I", "Peace Treaty", "International Relations"],
          historical_figures: [
            "Woodrow Wilson",
            "David Lloyd George",
            "Georges Clemenceau",
          ],
          summary:
            "The Treaty of Versailles was one of the peace treaties that ended World War I.",
          related_documents: [2, 3],
        },
        {
          id: 2,
          title: "The League of Nations",
          author: "Woodrow Wilson",
          date: "1920-01-10",
          themes: ["International Organizations", "Peacekeeping"],
          historical_figures: ["Woodrow Wilson"],
          summary:
            "The League of Nations was an international organization founded after World War I to maintain world peace.",
          related_documents: [1, 4],
        },
        {
          id: 3,
          title: "The Weimar Constitution",
          author: "Friedrich Ebert",
          date: "1919-08-11",
          themes: ["German History", "Political Systems"],
          historical_figures: ["Friedrich Ebert"],
          summary:
            "The Weimar Constitution was the constitution that governed Germany during the Weimar Republic.",
          related_documents: [1],
        },
        {
          id: 4,
          title: "The Atlantic Charter",
          author: "Franklin D. Roosevelt",
          date: "1941-08-14",
          themes: ["World War II", "Allied Powers", "International Relations"],
          historical_figures: ["Franklin D. Roosevelt", "Winston Churchill"],
          summary:
            "The Atlantic Charter was a pivotal policy statement issued during World War II, outlining the Allied goals for the post-war world.",
          related_documents: [2, 5],
        },
        {
          id: 5,
          title: "The United Nations Charter",
          author: "United Nations",
          date: "1945-10-24",
          themes: [
            "International Organizations",
            "Peacekeeping",
            "Global Governance",
          ],
          historical_figures: ["Harry S. Truman"],
          summary:
            "The United Nations Charter is the foundational treaty of the United Nations, an international organization established to promote peace and security.",
          related_documents: [4],
        },
      ];

      const themeFilter = document.getElementById("themeFilter");
      const authorFilter = document.getElementById("authorFilter");

      let timelineChart = null;
      let themesChart = null;

      // Populate filters with unique themes and authors
      function populateFilters() {
        const themes = new Set();
        const authors = new Set();

        documents.forEach((doc) => {
          doc.themes.forEach((theme) => themes.add(theme));
          authors.add(doc.author);
        });

        themes.forEach((theme) => {
          const option = document.createElement("option");
          option.value = theme;
          option.textContent = theme;
          themeFilter.appendChild(option);
        });

        authors.forEach((author) => {
          const option = document.createElement("option");
          option.value = author;
          option.textContent = author;
          authorFilter.appendChild(option);
        });
      }

      // Filter documents based on selected theme and author
      function filterDocuments() {
        const selectedTheme = themeFilter.value;
        const selectedAuthor = authorFilter.value;

        return documents.filter((doc) => {
          const matchesTheme = selectedTheme
            ? doc.themes.includes(selectedTheme)
            : true;
          const matchesAuthor = selectedAuthor
            ? doc.author === selectedAuthor
            : true;
          return matchesTheme && matchesAuthor;
        });
      }

      // Re-render visualizations based on filtered data
      function updateVisualizations() {
        const filteredDocuments = filterDocuments();
        renderTimeline(filteredDocuments);
        renderNetworkGraph(filteredDocuments);
        renderThemesAnalysis(filteredDocuments);
      }

      // Time-based Visualization (Timeline)
      function renderTimeline(docs) {
        const ctx = document.getElementById("timeline").getContext("2d");
        const labels = docs.map((doc) => doc.date);
        const data = {
          labels: labels,
          datasets: [
            {
              label: "Documents Timeline",
              data: labels.map((date) => new Date(date).getTime()),
              borderColor: "rgba(75, 192, 192, 1)",
              backgroundColor: "rgba(75, 192, 192, 0.2)",
              borderWidth: 1,
            },
          ],
        };

        // Destroy the existing chart before creating a new one
        if (timelineChart) {
          timelineChart.destroy();
        }

        timelineChart = new Chart(ctx, {
          type: "line",
          data: data,
          options: {
            scales: {
              x: {
                type: "time",
                time: {
                  unit: "year",
                },
              },
              y: {
                display: false,
              },
            },
          },
        });
      }

      // Network Graph Visualization
      function renderNetworkGraph(docs) {
        document.getElementById("networkGraph").innerHTML = ""; // Clear previous graph

        const svg = d3
          .select("#networkGraph")
          .append("svg")
          .attr("width", "100%")
          .attr("height", 300);

        const links = [];
        const nodes = docs.map((doc) => {
          doc.related_documents.forEach((rel) => {
            if (docs.some((d) => d.id === rel)) {
              links.push({ source: doc.id, target: rel });
            }
          });
          return { id: doc.id, title: doc.title };
        });

        const simulation = d3
          .forceSimulation(nodes)
          .force(
            "link",
            d3.forceLink(links).id((d) => d.id)
          )
          .force("charge", d3.forceManyBody().strength(-200))
          .force("center", d3.forceCenter(svg.node().clientWidth / 2, 150));

        const link = svg
          .append("g")
          .attr("stroke", "#999")
          .attr("stroke-opacity", 0.6)
          .selectAll("line")
          .data(links)
          .join("line");

        const node = svg
          .append("g")
          .attr("stroke", "#fff")
          .attr("stroke-width", 1.5)
          .selectAll("circle")
          .data(nodes)
          .join("circle")
          .attr("r", 6)
          .attr("fill", "steelblue")
          .call(drag(simulation));

        node.append("title").text((d) => d.title);

        node.on("click", (event, d) => showDocumentInfo(d.id));

        simulation.on("tick", () => {
          link
            .attr("x1", (d) => d.source.x)
            .attr("y1", (d) => d.source.y)
            .attr("x2", (d) => d.target.x)
            .attr("y2", (d) => d.target.y);

          node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
        });
      }

      // Thematic Analysis Visualization
      function renderThemesAnalysis(docs) {
        const ctx = document.getElementById("themesAnalysis").getContext("2d");
        const themesCount = {};
        docs.forEach((doc) => {
          doc.themes.forEach((theme) => {
            themesCount[theme] = (themesCount[theme] || 0) + 1;
          });
        });

        const data = {
          labels: Object.keys(themesCount),
          datasets: [
            {
              label: "Theme Analysis",
              data: Object.values(themesCount),
              backgroundColor: [
                "rgba(255, 99, 132, 0.2)",
                "rgba(54, 162, 235, 0.2)",
                "rgba(255, 206, 86, 0.2)",
              ],
              borderColor: [
                "rgba(255, 99, 132, 1)",
                "rgba(54, 162, 235, 1)",
                "rgba(255, 206, 86, 1)",
              ],
              borderWidth: 1,
            },
          ],
        };

        // Destroy the existing chart before creating a new one
        if (themesChart) {
          themesChart.destroy();
        }

        themesChart = new Chart(ctx, {
          type: "bar",
          data: data,
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      // Show detailed document info
      function showDocumentInfo(docId) {
        const doc = documents.find((d) => d.id === docId);
        const infoDiv = document.getElementById("documentInfo");
        infoDiv.innerHTML = `
                <h2>${doc.title}</h2>
                <p><strong>Date:</strong> ${doc.date}</p>
                <p><strong>Author:</strong> ${doc.author}</p>
                <p><strong>Themes:</strong> ${doc.themes.join(", ")}</p>
                <p><strong>Historical Figures:</strong> ${doc.historical_figures.join(
                  ", "
                )}</p>
                <p><strong>Summary:</strong> ${doc.summary}</p>
            `;
      }

      // Event listeners for filters
      themeFilter.addEventListener("change", updateVisualizations);
      authorFilter.addEventListener("change", updateVisualizations);

      // Initialize
      populateFilters();
      updateVisualizations();

      // Drag behavior for network graph nodes
      function drag(simulation) {
        return d3
          .drag()
          .on("start", (event, d) => {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
          })
          .on("drag", (event, d) => {
            d.fx = event.x;
            d.fy = event.y;
          })
          .on("end", (event, d) => {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
          });
      }
    </script>
  </body>
</html>
